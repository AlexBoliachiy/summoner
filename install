#!/bin/bash

set -eu

LOCAL_BIN=~/.local/bin

DEFAULT_OWNER=
DEFAULT_NAME=
DEFAULT_EMAIL=
DEFAULT_LICENSE=
DEFAULT_GHC=

# Replace "template" strings (e.g. `{{DEFAULT_OWNER}}`) in
# `hs-init.hs` with user-provided values.
set_default() {
  local setting="$1"
  local value="$2"

  sed_match="{{$setting}}"
  sed_cmd="s/$sed_match/$value/"

  sed -i.orig "$sed_cmd" hs-init.hs
}

set_defaults() {
  [ -n "$DEFAULT_OWNER" ] && set_default DEFAULT_OWNER "$DEFAULT_OWNER"
  [ -n "$DEFAULT_NAME" ] && set_default DEFAULT_NAME "$DEFAULT_NAME"
  [ -n "$DEFAULT_EMAIL" ] && set_default DEFAULT_EMAIL "$DEFAULT_EMAIL"
  [ -n "$DEFAULT_LICENSE" ] && set_default DEFAULT_LICENSE "$DEFAULT_LICENSE"
  [ -n "$DEFAULT_GHC" ] && set_default DEFAULT_GHC "$DEFAULT_GHC"
}

# Prompt for and set default settings values in `hs-init.hs`. Any
# values not provided are simply left as their template strings.
populate_defaults() {
  echo -n 'Default project owner: '
  read DEFAULT_OWNER

  echo -n 'Default name: '
  read DEFAULT_NAME

  echo -n 'Default email address: '
  read DEFAULT_EMAIL

  echo -n 'Default license: '
  read DEFAULT_LICENSE

  echo -n 'Default GHC version: '
  read DEFAULT_GHC

  set_defaults
}

wget https://raw.githubusercontent.com/vrom911/hs-init/master/hs-init.hs

populate_defaults

chmod +x hs-init.hs

[ -d "$LOCAL_BIN" ] || mkdir -p "$LOCAL_BIN"

mv hs-init.hs $LOCAL_BIN/hs-init
